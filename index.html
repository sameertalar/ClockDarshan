<!DOCTYPE html>
<html>
  <head>
    <title>Be Here Now</title>
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="shortcut icon" href="./img/clockDarshan.png" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <!-- <link rel="stylesheet" href="../libraries/bootstrap.min.css" />-->
    <link rel="stylesheet" href="lib/clock.darshan.css?v=003" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <style></style>
  </head>
  <body>
    <span
      id="trackerStatus"
      class="text-secondary small"
      style="position: absolute"
    >
      üëÄ
    </span>
    <div class="container-fluid screen-border">
      <div class="sticky-top">
        <div class="row">
          <div class="col-lg-4">
            <div class="text-center">
              <div
                class="text-center"
                id="containerBattery"
                style="display: none"
              >
                <iframe
                  id="frameBattery"
                  src=""
                  title="Battery Meditation"
                  width="100%"
                  height="20px"
                  style="border: none"
                >
                </iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <!-- Left  container-->
        <div class="col-lg-4">
          <div class="text-center">
            <div id="clockContainer">
              <div id="clock-container">
                <svg id="clock" viewBox="0 0 100 100">
                  <defs>
                    <linearGradient id="Gradient1">
                      <stop class="stop1" offset="0%" />
                      <stop class="stop2" offset="50%" />
                      <stop class="stop3" offset="100%" />
                    </linearGradient>
                    <linearGradient id="Gradient2" x1="0" x2="0" y1="0" y2="1">
                      <stop offset="0%" stop-color="red" />
                      <stop offset="50%" stop-color="black" stop-opacity="0" />
                      <stop offset="100%" stop-color="blue" />
                    </linearGradient>
                  </defs>
                  <circle id="face" cx="50" cy="50" r="60" />
                  <g transform="translate(50, 50)">
                    <circle
                      id="ClockInnerCircle"
                      cx="0"
                      cy="0"
                      r="5"
                      style="
                        fill: #0d2931;
                        stroke: #58727a;
                        stroke-width: 25;
                        stroke-dasharray: 31, 10;
                      "
                    >
                      <animateTransform
                        attributeType="xml"
                        attributeName="transform"
                        type="rotate"
                        from="0"
                        to="360"
                        begin="0"
                        dur="18s"
                        repeatCount="indefinite"
                      />
                    </circle>
                  </g>
                  <text id="currentTime" x="46.5" y="50">Be Here Now</text>
                  <g id="hands">
                    <rect
                      id="min"
                      x="48.5"
                      y="21"
                      width="5"
                      height="15"
                      rx="7"
                      ry="7"
                    />
                    <rect
                      id="hour"
                      x="48.5"
                      y="21"
                      width="7"
                      height="7"
                      rx="7"
                      ry="7"
                    />
                    <rect
                      id="onepointer"
                      x="48.5"
                      y="19"
                      width="4"
                      height="27"
                      rx="2"
                      ry="2"
                    />
                  </g>
                </svg>
              </div>
            </div>
            <!--  Progress-Start -->
            <div class="alert alert-success text-center" id="success-alert">
              <span id="alertMessage" class="text-danger"> </span>
            </div>
            <div
              class="alert alert-warning text-center"
              style="display: none"
              id="progress-loading"
            >
              <h3>
                <!--  <i class="fa fa-spinner fa-spin text-primary"></i> -->
                <span
                  class="spinner-border text-primary"
                  id="spinner"
                  role="status"
                ></span>
              </h3>
            </div>

            <!--  Progress-End -->

            <div id="containerRadios">
              <div id="containerWork2">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label class="btn btn-outline-primary active">
                    <input
                      type="radio"
                      class="radioWork"
                      id="radioWorkS"
                      name="radioWork"
                      value="S"
                    />
                    üïâ
                  </label>
                  <label class="btn btn-outline-primary active">
                    <input
                      type="radio"
                      class="radioWork"
                      id="radioWorkC"
                      name="radioWork"
                      value="C"
                    />
                    üõ†Ô∏è
                  </label>
                  <label class="btn btn-outline-warning active">
                    <input
                      type="radio"
                      class="radioWork"
                      id="radioWorkK"
                      name="radioWork"
                      value="K"
                      checked
                    />
                    üîÑ
                  </label>
                  <label class="btn btn-outline-success">
                    <input
                      type="radio"
                      class="radioWork"
                      id="radioWorkH"
                      name="radioWork"
                      value="H"
                    />
                    üåø
                  </label>
                  <label class="btn btn-outline-danger">
                    <input
                      type="radio"
                      class="radioWork"
                      id="radioWorkN"
                      name="radioWork"
                      value="N"
                    />
                    üö´
                  </label>
                </div>
              </div>
              <div id="containerEnergy2">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label class="btn btn-outline-success active">
                    <input
                      type="radio"
                      class="radioEnergy"
                      id="radioEnergyH"
                      name="radioEnergy"
                      value="H"
                    />
                    üîã
                  </label>
                  <label class="btn btn-outline-warning">
                    <input
                      type="radio"
                      class="radioEnergy"
                      id="radioEnergyM"
                      name="radioEnergy"
                      value="M"
                      checked
                    />
                    ü••
                  </label>
                  <label class="btn btn-outline-danger">
                    <input
                      type="radio"
                      class="radioEnergy"
                      id="radioEnergyL"
                      name="radioEnergy"
                      value="L"
                    />
                    ‚ö™
                  </label>
                </div>
              </div>
              <div id="containerMind2">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label class="btn btn-outline-primary active">
                    <input
                      type="radio"
                      class="radioMind"
                      id="radioMindC"
                      name="radioMind"
                      value="C"
                    />
                    üïä
                  </label>
                  <label class="btn btn-outline-success active">
                    <input
                      type="radio"
                      class="radioMind"
                      id="radioMindM"
                      name="radioMind"
                      value="M"
                    />
                    üßò
                  </label>
                  <label class="btn btn-outline-warning active">
                    <input
                      type="radio"
                      class="radioMind"
                      id="radioMindA"
                      name="radioMind"
                      value="A"
                      checked
                    />
                    üëÄ
                  </label>
                  <label class="btn btn-outline-dark">
                    <input
                      type="radio"
                      class="radioMind"
                      id="radioMindP"
                      name="radioMind"
                      value="P"
                    />
                    üé≥
                  </label>
                  <label class="btn btn-outline-danger">
                    <input
                      type="radio"
                      class="radioMind"
                      id="radioMindB"
                      name="radioMind"
                      value="B"
                    />
                    üò°
                  </label>
                </div>
              </div>
            </div>

            <div id="containerControls2" class="mt-2">
              <div class="text-center">
                <div class="btn-group">
                  <a
                    class="btn btn-info btn-lg active shrinkbtn"
                    data-toggle="collapse"
                    href="#collapseControlsSettings"
                    role="button"
                    aria-expanded="false"
                    aria-controls="collapseExample"
                  >
                    <i id="btnGear" class="fa fa-gear fa-2x"></i>
                  </a>
                  <button
                    id="btnTrackerSheetLoader"
                    type="button"
                    class="btn btn-info btn-lg active shrinkbtn"
                  >
                    <i class="fa fa-bar-chart"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="desktopMini">
              <div class="text-center">
                <span id="errorMessage" class="text-secondary small">
                  Be Here Now
                </span>
              </div>
            </div>
          </div>
        </div>
        <!-- Left  container end -->
        <!-- Right  container-->
        <div class="col-lg-8">
          <div>
            <div>
              <!-- Settings collapse  begin -->
              <div class="collapse" id="collapseControlsSettings">
                <div class="card card-body">
                  <!-- Settings Begin -->
                  <div>
                    <div class="form-group">
                      <button
                        id="btnResetSheetk"
                        type="button"
                        class="btn btn-danger btn-lg active shrinkbtn"
                      >
                        <i class="fa fa-random"></i> Reset Sheet
                      </button>

                      <button
                        id="btnPopup"
                        type="button"
                        class="btn btn-info pl-3 active shrinkbtn"
                      >
                        <i class="fa fa-window-restore"></i>
                      </button>

                      <button
                        type="button"
                        class="btn btn-info active"
                        id="btnBatteryLoader"
                      >
                        <i class="fa fa-battery-3"></i>
                      </button>
                      <button
                        type="button"
                        class="btn btn-info active"
                        id="btnWaveLoader"
                      >
                        <i class="fa fa-random"></i>
                      </button>
                      <a
                        class="btn btn-info active px-3"
                        data-toggle="collapse"
                        href="#collapseControlsMusic"
                        role="button"
                        aria-expanded="false"
                        aria-controls="collapseExample"
                      >
                        <i class="fa fa-music"></i>
                      </a>
                    </div>
                    <div class="form-group">
                      <div
                        id="containerWave"
                        class="text-center"
                        style="display: none"
                      >
                        <iframe
                          id="frameWave"
                          src=""
                          title="Wave Meditation"
                          width="100%"
                          height="650"
                          style="border: none"
                        >
                        </iframe>
                      </div>
                    </div>

                    <div class="form-group">
                      <!-- collapse Music Controls begin -->
                      <div class="collapse" id="collapseControlsMusic">
                        <div class="card card-body">
                          <div class="text-center form-group">
                            <button
                              id="btnPlayMeditationnAudio"
                              type="button"
                              class="btn btn-success"
                            >
                              <i class="fa fa-play"></i>
                              Play
                            </button>
                            <button
                              id="btnPauseMeditationAudio"
                              type="button"
                              class="btn btn-warning"
                            >
                              <i class="fa fa-pause"></i>
                              Pause
                            </button>

                            <div
                              class="custom-control pl-5 custom-radio custom-control-inline"
                            >
                              <input
                                type="radio"
                                checked
                                id="radioMeditationMusic18"
                                name="radioMeditationMusic"
                                class="custom-control-input"
                                value="media/SaReGaMa18Sec.mp3"
                              />
                              <label
                                class="custom-control-label"
                                for="radioMeditationMusic18"
                              >
                                <i class="fa fa-music"></i> 18 Sec
                              </label>
                            </div>
                            <div
                              class="custom-control custom-radio custom-control-inline"
                            >
                              <input
                                type="radio"
                                id="radioMeditationMusic20"
                                name="radioMeditationMusic"
                                class="custom-control-input"
                                value="media/SaReGaMa20Sec.mp3"
                              />
                              <label
                                class="custom-control-label"
                                for="radioMeditationMusic20"
                                ><i class="fa fa-music"></i> 20 Sec</label
                              >
                            </div>
                          </div>
                          <div class="form-group"></div>
                          <div class="form-group text-center">
                            <audio
                              id="audioMeditation"
                              class="form-control"
                              controls
                              loop
                              style="width: 100%"
                            >
                              <source
                                src="media/SaReGaMa18Sec.mp3"
                                type="audio/mp3"
                              />
                              Your browser does not support the audio element.
                            </audio>
                          </div>
                          <div class="form-group">
                            <label for="rangeMeditationMusicVolume">
                              <i class="fa fa-volume-up"></i> Meditation Music
                              Volume:
                              <span
                                id="rangeMeditationMusicVolumeLabel"
                                class="badge badge-light"
                              ></span>
                            </label>
                            <input
                              class="form-control"
                              id="rangeMeditationMusicVolume"
                              width="80%"
                              type="range"
                              min="0"
                              max="1"
                              step="0.01"
                              value="0.8"
                            />
                          </div>
                        </div>
                      </div>
                      <!-- collapse Music Controls end -->
                    </div>
                  </div>
                  <!-- Settings End -->
                </div>
              </div>
              <!--  Settings collapse  end -->
              <!-- Tracker Sheet  begin -->
              <div
                class="text-center border rounded"
                id="containerTrackerSheet"
                style="display: none"
              >
                <div
                  id="containerTrackerSheetscroll"
                  class="border border-primary"
                  style="height: 600px; overflow-y: scroll"
                >
                  <iframe
                    id="frameTrackerSheet"
                    src=""
                    title="Tracker Sheet"
                    style="border: none"
                    width="100%"
                    height="800"
                  >
                  </iframe>
                </div>
              </div>
              <!-- Tracker Sheet  end -->
            </div>
          </div>
          <div>
            <div class="text-center desktopMini">
              <!-- Buttons second row-->
              <!-- Buttons 2nd row end-->
            </div>
          </div>
        </div>
        <!-- Right  container end -->
      </div>
    </div>
    <!--
         <script src="../libraries/jquery-3.5.1.min.js"></script>
         <script src="../libraries/popper.min.js"></script>
         <script src="../libraries/bootstrap.min.js"></script>
         -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        const MEDIA_ROOT = "../ClockDarshanMedia/";
        var __AppEnabledStatus = false;
        var __ClockdarshanStatus = false;
        var __alertPlayIndicator = 0;
        var __dataConfig;

        // Load
        $("#btnTryChunk").on("click", tryChunkClick);
        $("#btnTrackerSheetLoader").on("click", loadTrackerSheetFrame);
        $("#btnBatteryLoader").on("click", loadBatteryFrame);
        $("#btnWaveLoader").on("click", loadWaveFrame);
        $("#btnPlayMeditationnAudio").on("click", playMeditationAudio);
        $("#btnPauseMeditationAudio").on("click", pauseMeditationAudio);
        $("#ClockInnerCircle").on("click", oneClickTracker);
        $("#btnResetSheetk").on("click", oneClickResetSheet);
        $("#btnPopup").on("click", btnPopupClick);
        $("#success-alert").hide();

        $("#radioMeditationMusic18").on("change", function (event) {
          musicSelected(this.value);
        });

        $("#radioMeditationMusic20").on("change", function (event) {
          musicSelected(this.value);
        });
        $("#rangeMeditationMusicVolume").on("change", function (event) {
          setMeditationMusicVolume(this.value);
        });

        setMeditationMusicVolume(0.8);

        console.log(
          "%cClock Darshan",
          "font-weight: bold; font-size: 50px; color: #ff4f51; text-shadow: 1px 1px 0px black, 1px -1px 0px black, -1px 1px 0px black, -1px -1px 0px black;"
        );

        // Load End

        // Clock hands position
        __ClockdarshanStatus = setInterval(function () {
          function r(el, deg) {
            el.setAttribute("transform", "rotate(" + deg + " 50 50)");
          }
          var d = new Date();
          let hourDeg = 30 * (d.getHours() % 12) + d.getMinutes() / 2;
          let minDeg = 6 * d.getMinutes();

          r(hour, hourDeg);
          r(min, 6 * d.getMinutes());
          r(onepointer, getOnePointerDegree(hourDeg, minDeg));
        }, 1000);

        __AppEnabledStatus = setInterval(processBeHereNow, 1000);

        function setAlertAudioVolume(value) {
          $("#audioAlert")[0].volume = value;
          $("#rangeAlertAudioVolumeLabel").text(parseInt(value * 100) + "%");
        }

        function getOnePointerDegree(hourDeg, minDeg) {
          let hdeg = 15;
          let hrem = hourDeg % 90;

          let mrem = minDeg % 90;

          if (hrem >= 30) hdeg = 45;
          if (hrem >= 60) hdeg = 75;

          return minDeg - mrem + hdeg;
        }

        function tryChunkClick() {
          let now = new Date();
          let min = now.getMinutes();
          let hours = now.getHours();
          playNotification(hours, min - (min % 5), 0, 0);
        }

        function btnPopupClick() {
          var myWindow = window.open(
            window.location.href,
            "",
            "width=250,height=250"
          );
        }

        function processBeHereNow() {
          try {
            let now = new Date();
            let hours = now.getHours();
            let min = now.getMinutes();
            let sec = now.getSeconds();
            let ms = now.getMilliseconds() / 1000;

            // show Current Time
            showCurrentTime(hours, min, sec);

            // process
            if (min % 15 === 0 && sec === 1) {
              playNotification(hours, min, sec, ms);
              console.log(" üîî***** Quarter (15 min) alert at ", new Date());
            }
          } catch (error) {
            console.log("Unhandled Error", error);
            $("#errorMessage").html("Unhandled Error: " + error);
          }
        }

        function playNotification(hours, minuteChunk, sec, ms) {
          __alertPlayIndicator = minuteChunk * 60 + sec;

          // 1.Before Alert
          playBeforeAlertAudio();
        }
        function playBeforeAlertAudio() {
          let fileName = $("#selectChunkBeforeAlertAudio")
            .find(":selected")
            .data("filename");

          let audioAlert = $("#audioAlert");

          if (fileName) {
            audioAlert.attr("src", MEDIA_ROOT + "alerts/" + fileName);
            audioAlert[0].play();
          } else {
            console.log("Audio alert is off. No file selected.");
          }
        }

        function loadTrackerSheetFrame() {
          if ($("#containerTrackerSheet").is(":visible")) {
            $("#frameTrackerSheet").attr("src", "");
            $("#containerTrackerSheet").hide(500);
          } else {
            $("#frameTrackerSheet").attr(
              "src",
              "https://docs.google.com/spreadsheets/d/1IeLBIUnPFC6-raeOoD1s80C-v8-Sl5rY1p38qFlQ0RY/edit#gid=1698318143"
            );

            $("#containerTrackerSheetscroll").height($(window).height() - 20);
            $("#frameTrackerSheet").height($(window).height() - 40);
            $("#containerTrackerSheet").show(500);
            $("#containerTrackerSheetscroll").scrollTop(100);
          }
        }

        function oneClickResetSheet() {
          $("#progress-loading").show();
          $("#success-alert").hide();

          let googleapireseturl =
            "https://script.google.com/macros/s/AKfycbzhx9voh2A2FOd-E2hR4-CFinQKV-R0X3CKvheKTBYa/dev?callback=?";

          $.ajax({
            crossOrigin: true,
            url: googleapireseturl,

            dataType: "jsonp",
            success: function (data, textStatus, xhr) {
              console.log("oneClickResetSheet response data", data);
              //alert('SUCCESS - ' + data)
              showAlert("<h2> Done : " + data + "</h2>");
              $("#progress-loading").hide();
            },
            error: function (xhr, error_text, statusText) {
              //alert('Sheet Reset Done with - ' + error_text)
              console.log("error_text", error_text);
              showAlert("<h2> Reset :" + error_text + "</h2>");
              $("#progress-loading").hide();
            },
          });
        }

        function oneClickTracker() {
          postToGoogle();
        }

        function postToGoogle() {
          $("#progress-loading").show();
          $("#success-alert").hide();

          let apiurl =
            "https://script.google.com/macros/s/AKfycbxJLoWhDykykVFykQfnvVAwri6wrYwU6xAIrhvOCGOh/dev";
          // Use Dev link no need to publish
          // "https://script.google.com/macros/s/AKfycbyOlFS1KprVp0UFfsfsjs8ibP-LbX4bnmDgKfy4s1qMUbaL6iLr/exec";

          let paramMind = $(".radioMind:checked").val(); // $("#selectMind option:selected").val();
          let paramEnergy = $(".radioEnergy:checked").val();
          let paramWork = $(".radioWork:checked").val();

          let now = new Date();
          let hours = now.getHours();
          let minutes = now.getMinutes();
          let quarter = 4;
          if (minutes < 45) {
            quarter = 3;
            if (minutes < 30) {
              quarter = 2;
              if (minutes < 15) {
                quarter = 1;
              }
            }
          }

          var paramtext = "&text=" + hours + "_" + minutes;

          let queryString =
            "?hour=" +
            hours +
            "&quarter=" +
            quarter +
            "&mind=" +
            paramMind +
            "&energy=" +
            paramEnergy +
            "&work=" +
            paramWork;

          console.log("queryString", queryString);

          let googleurl = apiurl + queryString + paramtext + "&callback=?";

          $.ajax({
            crossOrigin: true,
            url: googleurl,

            dataType: "jsonp",
            success: function (data, textStatus, xhr) {
              console.log(data);

              showAlert("<p>" + data + "</p>");
              $("#trackerStatus").html(
                data.replace("Success ", "") +
                  " ‚á¶" +
                  (hours % 12 || 12) +
                  "(" +
                  quarter +
                  ")"
              );
              console.log("response data", data);
              $("#progress-loading").hide();
            },
            error: function (xhr, error_text, statusText) {
              showAlert(error_text + "<br> Error while Processing");
              console.log("error_text", error_text);
              $("#progress-loading").hide();
            },
          });
        }

        function showAlert(text) {
          $("#alertMessage").html(text);
          $("#success-alert")
            .fadeTo(2000, 1500)
            .slideUp(15000, function () {
              $("#success-alert").slideUp(15000);
            });
        }

        function loadBatteryFrame() {
          if ($("#containerBattery").is(":visible")) {
            $("#frameBattery").attr("src", "");
            $("#containerBattery").hide(500);
          } else {
            $("#frameBattery").attr("src", "component/breathbattery.html");

            $("#containerBattery").show(500);
          }
        }

        function loadWaveFrame() {
          if ($("#containerWave").is(":visible")) {
            $("#frameWave").attr("src", "");
            $("#containerWave").hide(500);
          } else {
            $("#frameWave").attr("src", "component/wave.html");
            $("#containerWave").show(500);
          }
        }

        function musicSelected(value) {
          $("#audioMeditation").attr("src", value);
        }

        function playMeditationAudio() {
          $("#audioMeditation")[0].play();
        }

        function pauseMeditationAudio() {
          $("#audioMeditation")[0].pause();
        }

        function setMeditationMusicVolume(value) {
          $("#audioMeditation")[0].volume = value;
          $("#rangeMeditationMusicVolumeLabel").text(
            parseInt(value * 100) + "%"
          );
        }

        // ******* TIME Functions *******
        function showCurrentTime(hours, min, sec) {
          let hrs = hours % 12;
          var timeNow =
            //  (hrs === 0 ? "12" : pad(hrs, 2)) +   ":" +
            pad(min, 2) + ":" + pad(sec, 2);
          // +            " "
          // +            (hours > 12 ? "PM" : "AM");
          $("#currentTime").text(timeNow);
        }

        function pad(number, length) {
          var str = "" + number;
          while (str.length < length) {
            str = "0" + str;
          }

          return str;
        }
      });
    </script>
  </body>
</html>
