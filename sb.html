<!DOCTYPE html>
<html>
  <head>
    <title>Tracker Update</title>
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="theme-color" content="#12011e" />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <!-- https://getbootstrap.com/ -->
    <style>
      body {
        background-color: #c0bcc4;
      }

  
    </style>
  </head>
  <body>
    <div class="alert alert-success text-center" id="success-alert">
        <span id="alertMessage" class="text-danger">  </span>
     </div>
    <div class="container">
      <div class="row text-center">
        <div class="col">
          <h3>Hello World</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2">
            <label for="selectHour">
         
                 Chunk
              </label>
              <select
                class="form-control"
                id="selectHour"
              ></select>
            
            </div>
        <div class="col-md-2">
            <label for="selectHour">
         
                 .
              </label>
            
              <select
              class="form-control"
              id="selectQuarter"
            >
            <option value="1">1 </option>
            >
            <option value="2">2 </option>
            >
            <option value="3">3 </option>
            >
            <option value="4">4 </option>
        
        </select>
            </div>
        <div class="col-md-2">
            <label for="selectMind">
         
                 Mind
              </label>
              <select
                class="form-control"
                id="selectMind"
              ></select>
            </div>
            <div class="col-md-2">
                <label for="selectEnergy">
                   
                     Energy
                  </label>
                  <select
                    class="form-control"
                    id="selectEnergy"
                  ></select>
                </div>
                <div class="col-md-2">
                    <label for="selectWork">
                  
                       Work
                      </label>
                      <select
                        class="form-control"
                        id="selectWork"
                      ></select>
                    </div>
                    <div class="col-md-2">
                        <label for="btnTracker">
                      
                            Action
                          </label><br>
                        <button type="button" id="btnTracker" class="btn btn-success">
                            Submit
                          </button>
                          <button type="button" id="btnTest" class="btn btn-primary">
                            Test
                          </button>
                        </div>



        </div>
        <div class="col">
   
        </div>
      </div>
      <div class="row text-center">
        <div class="col mt-5">
          <span class="text-danger" id="result"></span>
          <span id="errorMessage" class="text-danger"> अप्रमाद </span>
        </div>

      
      </div>
    </div>
   

    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
    ></script>

    <script>
      $(document).ready(function () {

        var configuration = {
      mind: [
        { title: "Peace", code: "C", column: "C" },
        { title: "ध्यान", code: "M", column: "D" },
        { title: "अप्रमाद", code: "A", column: "E" },
        { title: "Focus", code: "F", column: "F" },
        { title: "Buzzing", code: "B", column: "G" },
      ],
      energy: [
        { title: "High", code: "H", column: "I" },
        { title: "Medium", code: "M", column: "J" },
        { title: "Low", code: "L", column: "K" },
      ],
      work: [
        { title: "Creativity", code: "C", column: "N" },
        { title: "Office", code: "W", column: "O" },
        { title: "Routine", code: "R", column: "P" },
        { title: "Family", code: "F", column: "Q" },
        { title: "Social", code: "S", column: "R" },
        { title: "None", code: "N", column: "S" },
      ],
    };




        // Page_Load EVENTS
        page_Load();

        function page_Load() {

     


            $("#success-alert").hide();
          $("#btnTracker").on("click", postToGoogle);
          $("#btnTest").on("click", testTracker);

          

        $.each(configuration.mind, function (index, value) {
                $("#selectMind").append(
                    $("<option></option>")
                    .attr("value", value.code)
                    .text(value.title)       
                );
        });

        $.each(configuration.energy, function (index, value) {
                $("#selectEnergy").append(
                    $("<option></option>")
                    .attr("value", value.code)
                    .text(value.title)       
                );
        });

        $.each(configuration.work, function (index, value) {
                $("#selectWork").append(
                    $("<option></option>")
                    .attr("value", value.code)
                    .text(value.title)       
                );
        });

        for (let n = 0; n < 24; ++ n)
        {
                $("#selectHour").append(
                $("<option></option>")
                .attr("value",n)
                .text(n)       
                );
            
        }

        $("#selectMind").prop("selectedIndex", 2);
        $("#selectEnergy").prop("selectedIndex", 1);
        $("#selectWork").prop("selectedIndex", 1);

        $("#selectHour").val(new Date().getHours());
    
    
    }


function testFunction(prop, code) {

let column ="";

    try {
        let column = configuration[prop].find(x => x.code === code).column;
        debugger;
        console.log(column);

    }
    catch(err) {
        debugger;
        column ="";
    }


}


 function postToGoogle() {



          
          let apiurl ="https://script.google.com/macros/s/AKfycbyBiIfoJWhf7oarBrXl6H8Rx5i2_QTxAvh6wxu6FFVH20OvPSk/exec";
          let paramHour =$("#selectHour option:selected").val();
          let paramQuarter =$("#selectQuarter option:selected").val();
          let paramMind= $("#selectMind option:selected").val();
          let paramEnergy = $("#selectEnergy option:selected").val();
          let paramWork = $("#selectWork option:selected").val();


        let now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        var paramtext ="&text="+hours+"_"+minutes;


          let queryString ="?hour="+paramHour+"&quarter="+paramQuarter+"&mind="+paramMind+"&energy="+paramEnergy+"&work="+paramWork ;

 
          console.log("queryString",queryString);

          let googleurl =apiurl+queryString+paramtext+"&callback=?";


 
          
        $.ajax({
            crossOrigin: true,
        url: googleurl,
      
        dataType: 'jsonp',     
        success: function (data, textStatus, xhr) {
           
             console.log(data);
          
             showAlert("Api Response:<br>" + data);
             console.log("response data",data);

           

        },
        error: function (xhr, error_text, statusText) {
             
            showAlert(error_text + "<br> Error while Processing"  );
            console.log("error_text",error_text);
        },
       

        })

        }

       
    function showAlert(text) {
        $("#alertMessage").html(text);
        $("#success-alert").fadeTo(8000, 20500).slideUp(500, function(){
        $("#success-alert").slideUp(500);
        });
    }

/***********************************************/

function testTracker()
{

    let paramHour =$("#selectHour option:selected").val();
          let paramQuarter =$("#selectQuarter option:selected").val();
          let paramMind= $("#selectMind option:selected").val();
          let paramEnergy = $("#selectEnergy option:selected").val();
          let paramWork = $("#selectWork option:selected").val();


        let now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        var paramtext ="&text="+hours+"_"+minutes;

        Process("",paramHour,paramQuarter,paramMind, paramEnergy, paramWork);
}



function Process(
  sheet,
  paramHour,
  paramQuarter,
  paramMind,
  paramEnergy,
  paramWork 
) {
    
  paramHour = parseInt(paramHour);


  let rowNumber = paramHour + parseInt(paramQuarter) - 1;
 

if (paramMind) {
  UpdateColumn(sheet, rowNumber, "mind", paramMind);
}
if (paramEnergy) {
  UpdateColumn(sheet, rowNumber, "energy", paramEnergy);
}
if (paramWork) {
  UpdateColumn(sheet, rowNumber, "work", paramWork);
}

clockDarshanReturnValue = "Success";

 
}

function UpdateColumn(sheet, rowNumber, prop, code) {
  var column = getColumn(prop, code);

  if (column) {
      console.log("Update Sheet for", prop," row:", rowNumber," code:", code," column:", column)
    //sheet.getRange(column + rowNumber).check();
  }
}

function getColumn(prop, code) {
  let column = "";

  try {
     column = configuration[prop].find((x) => x.code === code).column;
    debugger;
    console.log(column);
  } catch (err) {
    debugger;
    column = "";
  }

  return column;
}


    /*************************************************/

      });
    </script>
  </body>
</html>
